---
title: "AVPlayerã®durationã®å–å¾—"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["swiftUI", "AVPlayer",]
published: true
---

# AVPlayerã®durationã®å–å¾—


## è§£æ±ºç­–
AVPlayerã‹ã‚‰ã§ã¯ãªãã€AVAssetã‹ã‚‰durationã‚’å–å¾—ã™ã‚‹ã€‚

```swift
# ã“ã‚Œã§æ­£ã—ã„å€¤ãŒå–å¾—ã§ãã¾ã—ãŸã€‚
let asset = AVURLAsset(url: validURL, options: [AVURLAssetPreferPreciseDurationAndTimingKey: true])
let assetDuration = try await CMTimeGetSeconds(asset.load(.duration))
print ("asset duration :", assetDuration)

```

ã“ã‚Œã§ã‚‚1ç§’2ç§’ã®èª¤å·®ãŒã‚ã‚‹ã‚‚ã®ã®ã€ä½¿ãˆã‚‹ç¨‹åº¦ã®å€¤ãŒå–å¾—ã§ãã¾ã—ãŸã€‚
```swift
private var player = AVPlayer()
var duration: TimeInterval {
guard let playerItem = player.currentItem, playerItem.status == .readyToPlay else {
    return 0.0
}
return CMTimeGetSeconds(playerItem.duration)
}
```


ã‚‚ã—ãã¯ã€ã“ã‚Œã§ã‚‚èª¤å·®ãŒã‚ã‚Šã¾ã™ãŒå–å¾—ã§ãã¾ã—ãŸã€‚
ï¼ˆã“ã‚Œã ã¨duplicatedã—ã¦ã„ã‚‹ã¨ã„ã†è­¦å‘ŠãŒå‡ºã¾ã™ã€‚ï¼‰
```swift
private var player = AVPlayer()
var duration: TimeInterval {
guard let playerItem = player.currentItem, playerItem.status == .readyToPlay else {
    return 0.0
}
return CMTimeGetSeconds(playerItem.asset.duration)
}
```


## èƒŒæ™¯ã¨è©¦ã—ãŸã“ã¨

AVPlayerã§mp3ã®durationã‚’å–å¾—ã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€
ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯durationã®å€¤ãŒå¤§ãããªã£ãŸã‚Šå°ã•ããªã£ãŸã‚Šã—ã¦æ­£ã—ãå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

```swift

# è©¦ã—ãŸã‚³ãƒ¼ãƒ‰1

do {
    if let currentItem = self.audioPlayer?.currentItem {
        let durationSeconds = try await CMTimeGetSeconds(currentItem.asset.load(.duration))
        print ("durationSeconds :", durationSeconds)
    }
} catch {
    print("Error: \(error)")
}

```


```swift

# è©¦ã—ãŸã‚³ãƒ¼ãƒ‰2
# èª­ã¿è¾¼ã¿ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°é–¢é€£ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã¨æ€ã„ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è©¦ã—ã¾ã—ãŸãŒåŒã˜çµæœã§ã—ãŸã€‚

func loadDuration(of url: URL) async {
    let asset = AVAsset(url: url)
    
    // Create an array containing the asset keys we need to be loaded
    let keys = ["duration"]
    
    await withCheckedContinuation { continuation in
        // Load the asset's keys asynchronously
        asset.loadValuesAsynchronously(forKeys: keys) {
            // The keys are loaded, now access the duration
            var error: NSError?
            let status = asset.statusOfValue(forKey: "duration", error: &error)
            
            if status == .loaded {
                let duration = asset.duration
                let durationSeconds = CMTimeGetSeconds(duration)
                
                DispatchQueue.main.async {
                    print("Duration seconds:", self.timeString(time: durationSeconds))
                    continuation.resume()
                }

            } else if status == .failed {
                print("Failed to load duration with error: \(String(describing: error))")
                continuation.resume(throwing: (error ?? NSError(domain: "AVAssetDurationError", code: 0, userInfo: nil)) as! Never)
            } else {
                print("Duration not available yet.")
                continuation.resume()
            }
        }
    }
}
  
```

## ç’°å¢ƒ
Xcode Version 15.2

## å‚è€ƒ
[iOS 11 AVPlayer/mp3 currentTime not accurate](https://stackoverflow.com/questions/47158688/ios-11-avplayer-mp3-currenttime-not-accurate)

